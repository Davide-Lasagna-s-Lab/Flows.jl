<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quadrature equations · Flows.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Flows.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><a class="toctext" href="../quickstart/">Quick Start</a></li><li><a class="toctext" href="../monitors/">Monitors</a></li><li><a class="toctext" href="../available-methods/">Available methods</a></li><li><a class="toctext" href="../coupled/">Coupled systems</a></li><li class="current"><a class="toctext" href>Quadrature equations</a><ul class="internal"><li><a class="toctext" href="#Fundamentals-1">Fundamentals</a></li><li><a class="toctext" href="#Approach-1">Approach</a></li></ul></li><li><a class="toctext" href="../examples/">Examples</a></li><li><a class="toctext" href="../advanced/">Advanced features</a></li><li><a class="toctext" href="../api/">Full API</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Quadrature equations</a></li></ul><a class="edit-page" href="https://github.com/gasagna/Flows.jl/blob/master/docs/src/quadrature.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Quadrature equations</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Calculating-integrals-1" href="#Calculating-integrals-1">Calculating integrals</a></h1><h2><a class="nav-anchor" id="Fundamentals-1" href="#Fundamentals-1">Fundamentals</a></h2><p>It is sometimes necessary to calculate the integral of some function <span>$g : \mathcal{X} \rightarrow \mathbb{R}$</span> along a trajectory of the system, i.e. the integral</p><div>\[I = \int_0^T g(\mathbf{x}(t))\mathrm{d}t\]</div><p>where <span>$\mathbf{x}(t)\in\mathcal{X}$</span> is the system&#39;s state.</p><p>This can be achieved by adding a pure quadrature equation, i.e. augmenting the dynamical system with a further equations that gets integrated in time jointly with the main problem. In other words, the coupled system</p><div>\[\left\{
\begin{array}{c}
  \dot{\mathbf{x}}(t) &amp;= \mathbf{f}(t, \mathbf{x}(t))\\
  \dot{I}(t) &amp;= g(\mathbf{x}(t))
\end{array}
\right.\]</div><p>is integrated from <span>$0$</span> to <span>$T$</span> with initial condition <span>$I(0) = 0$</span>. It is easy to see that the final condition <span>$I(T)$</span>  is the numerical approximation of the integral above. This package&#39;s implementation of this feature relies on the ability to march coupled systems of equations (see <a href="@ref">Flows.jl Coupled systems</a>).</p><p>The usefulness of this approach is that the integral is obtained without doing much, at the end of the integration. In addition, the order of accuracy of the integration methods used to advance the coupled state is the order of accuracy of the estimation of the integral above.</p><h2><a class="nav-anchor" id="Approach-1" href="#Approach-1">Approach</a></h2><p>As an example let us compute the integral of the function </p><div>\[g(\mathbf{x}) = x_1^2\]</div><p>for a system with three degrees of freedom arranged in a standard Julia <code>Vector</code>. First we define the quadrature equation </p><pre><code class="language-julia">g(t, x, dxdt, I, dIdt) = (dIdt[1] = x[1]^2; return dIdt)</code></pre><p>Note the structure of the signature, which is characteristic of coupled systems (see <a href="@ref">Coupled systems</a>).</p><p>We then define some initial conditions, making sure <code>I[1]</code> is initially set to  zero.</p><pre><code class="language-julia">x = Float64[1.0, 3.0, 4.0]
I = Float64[0.0]</code></pre><p>Note that because the state must be mutable, the extra quadrature variable must be stored in a mutable container, a one element <code>Vector</code>. In fact, one can calculate the integral of as many functions as desired, just define the function <code>g</code> above to fill as many components of <code>dIdt</code> as required.</p><p>We then define a <a href="../api/#Flows.Flow"><code>Flows.Flow</code></a> operator, by coupling the right hand side of the differential equation (assume it is defined by a julia function <code>f</code>) and the additional quadrature equation</p><pre><code class="language-julia">F = flow(couple(f, g), RK4(couple(x, I)), TimeStepConstant(0.1))</code></pre><p>Note how the state and the quadrature variables are coupled toghether and passed to the <a href="../api/#Flows.RK4"><code>RK4</code></a> constructor. This makes sure that the temporary objects in the Runge-Kutta scheme are consistent with the extra degree of freedom.</p><p>The flow operator can be now called with</p><pre><code class="language-julia">F(couple(x, I), (0, 10))</code></pre><p>where <code>x</code> is advanced forward in time from <span>$t=0$</span> to <span>$t=10$</span>. Upon return <code>I[1]</code> contains an approximation of the integral</p><div>\[\int_0^{10} x_1^2(t)\mathrm{d}t\]</div><div class="admonition example"><div class="admonition-title">Example</div><div class="admonition-text"><p>It is possible to monitor the value of the quadrature variable along a simulation. For instance, let us calculate the cumulative average of the function <span>$g(\mathbf{x}(t))$</span>, the quantity</p><div>\[\bar{g}(\tau) = \frac{1}{\tau} \int_0^\tau g(\mathbf{x}(t))\mathrm{d}t\]</div><p>To do so, simply define a <code>Monitor</code> object that observes the quadrature component</p><pre><code class="language-julia">mon = Monitor(couple(x, I), xq-&gt;xq[2])</code></pre><p>After numerical integration, samples of the function <span>$\bar{g}$</span> can be obtained as</p><pre><code class="language-julia">g_bar = samples(mon)./times(mon)</code></pre><p>where the first element is undefined.</p></div></div><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"><p>The quadrature equation can typically be integrated explicitly, even if a semi-implicit scheme is required for the main dynamics. In this case, one can couple the stiff linear part, say <code>f_im</code>, with the <code>nothing</code> value, as</p><pre><code class="language-julia">F = flow(couple(f_ex, g), couple(f_im, nothing), CNRK2(couple(x, I)), TimeStepConstant(0.1))</code></pre><p>where <a href="../api/#Flows.CNRK2"><code>CNRK2</code></a> is used as an example. The value <code>nothing</code> signals that the quadrature <code>g</code> is advanced in time using on the explicit component of the semi-implicit scheme.</p></div></div><footer><hr/><a class="previous" href="../coupled/"><span class="direction">Previous</span><span class="title">Coupled systems</span></a><a class="next" href="../examples/"><span class="direction">Next</span><span class="title">Examples</span></a></footer></article></body></html>
